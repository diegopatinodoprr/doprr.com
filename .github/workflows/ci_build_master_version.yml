on:
  workflow_dispatch:
    inputs:
      tag:
        description: 'select tags'
        required: false
        options: ['major', 'minor', 'patch']
        default: ' '
env:
      ACTIONS_ALLOW_UNSECURE_COMMANDS: 'true'
      GITHUB_TOKEN: s{{secrets.DOPRR_TOKEN}}
      NODE_VERSION: 'v14.15.4'
      VERSION_TAG: ""
      MODULE_VERSION: ""
name: Generate Master Version
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checout repository
        uses: actions/checkout@v2
        with:
          ref: master
      - name: Update Dis and package.json
        run: |
          rm -rf dist
          rm package.json
          git config  user.email "diegopatino@doprr.com"
          git config  user.name "Diego Patino"
          git checkout origin/develop -- dist
          git checkout origin/develop -- package.json
      - name: find the version On package.json
        id: set_var
        run: |
          content=`cat package.json`
          # the following lines are only required for multi line json
          content="${content//'%'/'%25'}"
          content="${content//$'\n'/'%0A'}"
          content="${content//$'\r'/'%0D'}"
          # end of optional handling for multi line json
          echo "::set-output name=packageJson::$content"
      - name: Update runner VERSION_TAG env
        run: |
          echo "::set-env name=VERSION_TAG::${{fromJson(steps.set_var.outputs.packageJson).version}}"
      - name: Update dist folder
        run: |
          git add .
          git commit -am"Generate new version ${{env.VERSION_TAG}}"
          git tag -f ${{env.VERSION_TAG}}
          git push -f --tags
      